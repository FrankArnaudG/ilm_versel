// import { NextRequest, NextResponse } from 'next/server';
// import { Resend } from 'resend';

// const resend = new Resend(process.env.RESEND_API_KEY);
// const ADMIN_EMAIL = process.env.ADMIN_EMAIL || 'admin@ecocom.fr';

// export async function POST(request: NextRequest) {
//   try {
//     const { type, orderId, orderNumber, error, skybillNumber, pickupDate, locality } = await request.json();

//     let subject = '';
//     let htmlContent = '';

//     // ============================================
//     // EMAIL : √âTIQUETTE G√âN√âR√âE AVEC SUCC√àS
//     // ============================================
//     if (type === 'success') {
//       subject = `‚úÖ √âtiquette Chronopost g√©n√©r√©e - ${orderNumber}`;
//       htmlContent = `
//         <!DOCTYPE html>
//         <html>
//         <head>
//           <style>
//             body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
//             .container { max-width: 600px; margin: 0 auto; padding: 20px; }
//             .header { background: #10b981; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
//             .content { background: #f9fafb; padding: 20px; border: 1px solid #e5e7eb; }
//             .info-box { background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #10b981; }
//             .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f3f4f6; }
//             .label { font-weight: bold; color: #6b7280; }
//             .value { color: #111827; }
//             .btn { display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin-top: 15px; }
//             .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 12px; }
//           </style>
//         </head>
//         <body> 
//           <div class="container">
//             <div class="header">
//               <h1>‚úÖ √âtiquette Chronopost g√©n√©r√©e</h1>
//             </div>
            
//             <div class="content">
//               <p>Une nouvelle √©tiquette d'exp√©dition a √©t√© g√©n√©r√©e avec succ√®s.</p>
              
//               <div class="info-box">
//                 <div class="info-row">
//                   <span class="label">N¬∞ de commande :</span>
//                   <span class="value">${orderNumber}</span>
//                 </div>
//                 <div class="info-row">
//                   <span class="label">N¬∞ de suivi :</span>
//                   <span class="value"><strong>${skybillNumber}</strong></span>
//                 </div>
//                 <div class="info-row">
//                   <span class="label">Localit√© :</span>
//                   <span class="value">${locality}</span>
//                 </div>
//                 <div class="info-row">
//                   <span class="label">Date :</span>
//                   <span class="value">${new Date().toLocaleString('fr-FR')}</span>
//                 </div>
//               </div>
              
//               <p><strong>Prochaine √©tape :</strong> T√©l√©chargez l'√©tiquette et pr√©parez le colis pour l'exp√©dition.</p>
              
//               <a href="${process.env.NEXT_PUBLIC_APP_URL}/admin/orders/${orderId}/shipping" class="btn">
//                 Voir la commande
//               </a>
//             </div>
            
//             <div class="footer">
//               <p>Email automatique - Ne pas r√©pondre</p>
//             </div>
//           </div>
//         </body>
//         </html>
//       `;
//     }

//     // ============================================
//     // EMAIL : ERREUR DE G√âN√âRATION
//     // ============================================
//     else if (type === 'error') {
//       subject = `‚ùå Erreur g√©n√©ration √©tiquette - ${orderNumber}`;
//       htmlContent = `
//         <!DOCTYPE html>
//         <html>
//         <head>
//           <style>
//             body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
//             .container { max-width: 600px; margin: 0 auto; padding: 20px; }
//             .header { background: #ef4444; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
//             .content { background: #fef2f2; padding: 20px; border: 1px solid #fecaca; }
//             .error-box { background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ef4444; }
//             .btn { display: inline-block; background: #dc2626; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin-top: 15px; }
//             .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 12px; }
//           </style>
//         </head>
//         <body>
//           <div class="container">
//             <div class="header">
//               <h1>‚ùå Erreur g√©n√©ration √©tiquette</h1>
//             </div>
            
//             <div class="content">
//               <p><strong>‚ö†Ô∏è Action requise :</strong> La g√©n√©ration automatique de l'√©tiquette Chronopost a √©chou√©.</p>
              
//               <div class="error-box">
//                 <p><strong>Commande :</strong> ${orderNumber}</p>
//                 <p><strong>Erreur :</strong></p>
//                 <pre style="background: #fee; padding: 10px; border-radius: 4px; overflow-x: auto;">${error}</pre>
//               </div>
              
//               <p><strong>Que faire ?</strong></p>
//               <ul>
//                 <li>V√©rifier les donn√©es de la commande</li>
//                 <li>V√©rifier les adresses et le poids des articles</li>
//                 <li>R√©g√©n√©rer l'√©tiquette manuellement depuis l'interface admin</li>
//                 <li>Contacter Chronopost si le probl√®me persiste</li>
//               </ul>
              
//               <a href="${process.env.NEXT_PUBLIC_APP_URL}/admin/orders/${orderId}/shipping" class="btn">
//                 R√©soudre le probl√®me
//               </a>
//             </div>
            
//             <div class="footer">
//               <p>Email automatique - Ne pas r√©pondre</p>
//             </div>
//           </div>
//         </body>
//         </html>
//       `;
//     }

//     // ============================================
//     // EMAIL : ENL√àVEMENT DEMAND√â
//     // ============================================
//     else if (type === 'pickup') {
//       subject = `üì¶ Enl√®vement Chronopost demand√© - ${orderNumber}`;
//       htmlContent = `
//         <!DOCTYPE html>
//         <html>
//         <head>
//           <style>
//             body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
//             .container { max-width: 600px; margin: 0 auto; padding: 20px; }
//             .header { background: #8b5cf6; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
//             .content { background: #faf5ff; padding: 20px; border: 1px solid #e9d5ff; }
//             .info-box { background: white; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #8b5cf6; }
//             .btn { display: inline-block; background: #7c3aed; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin-top: 15px; }
//             .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 12px; }
//           </style>
//         </head>
//         <body>
//           <div class="container">
//             <div class="header">
//               <h1>üì¶ Enl√®vement Chronopost demand√©</h1>
//             </div>
            
//             <div class="content">
//               <p>Un enl√®vement a √©t√© demand√© aupr√®s de Chronopost.</p>
              
//               <div class="info-box">
//                 <p><strong>Commande :</strong> ${orderNumber}</p>
//                 <p><strong>N¬∞ de suivi :</strong> ${skybillNumber}</p>
//                 <p><strong>Date d'enl√®vement pr√©vue :</strong> ${new Date(pickupDate.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')).toLocaleDateString('fr-FR')}</p>
//               </div>
              
//               <p><strong>√Ä faire :</strong></p>
//               <ul>
//                 <li>Pr√©parer le colis avec l'√©tiquette coll√©e</li>
//                 <li>√ätre disponible pour la collecte Chronopost</li>
//                 <li>Scanner le colis lors de la remise au chauffeur</li>
//               </ul>
              
//               <a href="${process.env.NEXT_PUBLIC_APP_URL}/admin/orders/${orderId}/shipping" class="btn">
//                 Voir la commande
//               </a>
//             </div>
            
//             <div class="footer">
//               <p>Email automatique - Ne pas r√©pondre</p>
//             </div>
//           </div>
//         </body>
//         </html>
//       `;
//     }

//     // ============================================
//     // ENVOI DE L'EMAIL
//     // ============================================
//     const { data, error: resendError } = await resend.emails.send({
//       from: 'ECOCOM Notifications <notifications@ecocom.fr>',
//       to: [ADMIN_EMAIL],
//       subject,
//       html: htmlContent
//     });

//     if (resendError) {
//       console.error('‚ùå Erreur Resend:', resendError);
//       return NextResponse.json({
//         success: false,
//         error: resendError.message
//       }, { status: 500 });
//     }

//     console.log('‚úÖ Email admin envoy√©:', data?.id);

//     return NextResponse.json({
//       success: true,
//       emailId: data?.id
//     });

//   } catch (error: any) {
//     console.error('‚ùå Erreur notification admin:', error);
//     return NextResponse.json({
//       success: false,
//       error: error.message
//     }, { status: 500 });
//   }
// }